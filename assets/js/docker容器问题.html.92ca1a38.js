"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[331],{6262:(a,n)=>{n.A=(a,n)=>{const e=a.__vccOpts||a;for(const[a,s]of n)e[a]=s;return e}},3187:(a,n,e)=>{e.r(n),e.d(n,{comp:()=>r,data:()=>l});var s=e(641);const i=[(0,s.Fv)('<h1 id="用gpu运行docker容器" tabindex="-1"><a class="header-anchor" href="#用gpu运行docker容器"><span>用GPU运行docker容器</span></a></h1><h2 id="前置条件" tabindex="-1"><a class="header-anchor" href="#前置条件"><span>前置条件</span></a></h2><ul><li>Nvidia显卡</li><li>安装nvidia-container-runtime</li></ul><h3 id="安装nvidia-container-runtime" tabindex="-1"><a class="header-anchor" href="#安装nvidia-container-runtime"><span>安装nvidia-container-runtime</span></a></h3><ol><li><p>添加Nvidia官方apt软件源（必须）</p><p>创建脚本文件nvidia-container-runtime-script.sh</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">touch</span> nvidia-container-runtime-script.sh\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>脚本内添加以下内容</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># nvidia-container-runtime-script.sh</span>\n\n<span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-L</span> https://nvidia.github.io/nvidia-container-runtime/gpgkey <span class="token operator">|</span> <span class="token punctuation">\\</span>\n  <span class="token function">sudo</span> apt-key <span class="token function">add</span> -\n<span class="token assign-left variable">distribution</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/os-release<span class="token punctuation">;</span><span class="token builtin class-name">echo</span> $ID$VERSION_ID<span class="token variable">)</span></span>\n<span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-L</span> https://nvidia.github.io/nvidia-container-runtime/<span class="token variable">$distribution</span>/nvidia-container-runtime.list <span class="token operator">|</span> <span class="token punctuation">\\</span>\n  <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/nvidia-container-runtime.list\n<span class="token function">sudo</span> <span class="token function">apt-get</span> update\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行脚本</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">sh</span> nvidia-container-runtime-script.sh\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>apt安装</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nvidia-container-runtime\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装完成后验证一下，输入：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">which</span> nvidia-container-runtime\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>应当得到输出：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>/usr/bin/nvidia-container-runtime\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="用法" tabindex="-1"><a class="header-anchor" href="#用法"><span>用法</span></a></h2><p>在创建容器时添加--gpus all的参数，例如</p><div class="language-cmd line-numbers-mode" data-ext="cmd" data-title="cmd"><pre class="language-cmd"><code>docker run --gpus all image_name:tag_name\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="报错" tabindex="-1"><a class="header-anchor" href="#报错"><span>报错</span></a></h2><div class="language-cmd line-numbers-mode" data-ext="cmd" data-title="cmd"><pre class="language-cmd"><code>docker: Error response from daemon: could not select device driver “” with capabilities: [[gpu]].\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h3><p>安装nvidia-container-runtime</p><h1 id="容器间通信" tabindex="-1"><a class="header-anchor" href="#容器间通信"><span>容器间通信</span></a></h1><h2 id="通过宿主机ip-port" tabindex="-1"><a class="header-anchor" href="#通过宿主机ip-port"><span>通过宿主机ip:port</span></a></h2><p>只能依靠监听在暴露出的端口的进程来进行有限的通信。</p><h2 id="通过-user-defined-networks" tabindex="-1"><a class="header-anchor" href="#通过-user-defined-networks"><span>通过 User-defined networks</span></a></h2><p>通过以下命令创建自定义桥接网络，这样同一桥接网络中的容器就可以通过互相访问</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> network create network_name\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在创建容器时，使用参数--network，如</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>docker run -d --network network_name --name container1 image_name:tag_name\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--network</span> network_name <span class="token parameter variable">--name</span> container2 image_name:tag_name\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样两容器间就可以通过<strong>容器名</strong>的形式通信</p><p>如</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> container1 <span class="token function">ping</span> container2\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>',24)],t={},r=(0,e(6262).A)(t,[["render",function(a,n){return(0,s.uX)(),(0,s.CE)("div",null,i)}]]),l=JSON.parse('{"path":"/docker%E5%AE%B9%E5%99%A8%E9%97%AE%E9%A2%98.html","title":"Docker杂项","lang":"zh-CN","frontmatter":{"title":"Docker杂项","category":"Docker","description":"用GPU运行docker容器 前置条件 Nvidia显卡 安装nvidia-container-runtime 安装nvidia-container-runtime 添加Nvidia官方apt软件源（必须） 创建脚本文件nvidia-container-runtime-script.sh 脚本内添加以下内容 运行脚本 apt安装 安装完成后验证一下，输...","head":[["meta",{"property":"og:url","content":"https://Misty-Star.github.io/docker%E5%AE%B9%E5%99%A8%E9%97%AE%E9%A2%98.html"}],["meta",{"property":"og:site_name","content":"MistyStar"}],["meta",{"property":"og:title","content":"Docker杂项"}],["meta",{"property":"og:description","content":"用GPU运行docker容器 前置条件 Nvidia显卡 安装nvidia-container-runtime 安装nvidia-container-runtime 添加Nvidia官方apt软件源（必须） 创建脚本文件nvidia-container-runtime-script.sh 脚本内添加以下内容 运行脚本 apt安装 安装完成后验证一下，输..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-31T03:17:22.000Z"}],["meta",{"property":"article:author","content":"MistyStar"}],["meta",{"property":"article:modified_time","content":"2024-05-31T03:17:22.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker杂项\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-31T03:17:22.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MistyStar\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"前置条件","slug":"前置条件","link":"#前置条件","children":[{"level":3,"title":"安装nvidia-container-runtime","slug":"安装nvidia-container-runtime","link":"#安装nvidia-container-runtime","children":[]}]},{"level":2,"title":"用法","slug":"用法","link":"#用法","children":[]},{"level":2,"title":"报错","slug":"报错","link":"#报错","children":[{"level":3,"title":"解决方案","slug":"解决方案","link":"#解决方案","children":[]}]},{"level":2,"title":"通过宿主机ip:port","slug":"通过宿主机ip-port","link":"#通过宿主机ip-port","children":[]},{"level":2,"title":"通过 User-defined networks","slug":"通过-user-defined-networks","link":"#通过-user-defined-networks","children":[]}],"git":{"createdTime":1717125442000,"updatedTime":1717125442000,"contributors":[{"name":"Misty-Star","email":"1278734874@qq.com","commits":1}]},"readingTime":{"minutes":1.17,"words":351},"filePathRelative":"docker容器问题.md","localizedDate":"2024年5月31日","excerpt":"\\n<h2>前置条件</h2>\\n<ul>\\n<li>Nvidia显卡</li>\\n<li>安装nvidia-container-runtime</li>\\n</ul>\\n<h3>安装nvidia-container-runtime</h3>\\n<ol>\\n<li>\\n<p>添加Nvidia官方apt软件源（必须）</p>\\n<p>创建脚本文件nvidia-container-runtime-script.sh</p>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token function\\">sudo</span> <span class=\\"token function\\">touch</span> nvidia-container-runtime-script.sh\\n</code></pre></div><p>脚本内添加以下内容</p>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token comment\\"># nvidia-container-runtime-script.sh</span>\\n\\n<span class=\\"token function\\">sudo</span> <span class=\\"token function\\">curl</span> <span class=\\"token parameter variable\\">-s</span> <span class=\\"token parameter variable\\">-L</span> https://nvidia.github.io/nvidia-container-runtime/gpgkey <span class=\\"token operator\\">|</span> <span class=\\"token punctuation\\">\\\\</span>\\n  <span class=\\"token function\\">sudo</span> apt-key <span class=\\"token function\\">add</span> -\\n<span class=\\"token assign-left variable\\">distribution</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">.</span> /etc/os-release<span class=\\"token punctuation\\">;</span><span class=\\"token builtin class-name\\">echo</span> $ID$VERSION_ID<span class=\\"token variable\\">)</span></span>\\n<span class=\\"token function\\">sudo</span> <span class=\\"token function\\">curl</span> <span class=\\"token parameter variable\\">-s</span> <span class=\\"token parameter variable\\">-L</span> https://nvidia.github.io/nvidia-container-runtime/<span class=\\"token variable\\">$distribution</span>/nvidia-container-runtime.list <span class=\\"token operator\\">|</span> <span class=\\"token punctuation\\">\\\\</span>\\n  <span class=\\"token function\\">sudo</span> <span class=\\"token function\\">tee</span> /etc/apt/sources.list.d/nvidia-container-runtime.list\\n<span class=\\"token function\\">sudo</span> <span class=\\"token function\\">apt-get</span> update\\n</code></pre></div><p>运行脚本</p>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token function\\">sudo</span> <span class=\\"token function\\">sh</span> nvidia-container-runtime-script.sh\\n</code></pre></div></li>\\n<li>\\n<p>apt安装</p>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token function\\">sudo</span> <span class=\\"token function\\">apt-get</span> <span class=\\"token function\\">install</span> nvidia-container-runtime\\n</code></pre></div><p>安装完成后验证一下，输入：</p>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token function\\">which</span> nvidia-container-runtime\\n</code></pre></div><p>应当得到输出：</p>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code>/usr/bin/nvidia-container-runtime\\n</code></pre></div></li>\\n</ol>","autoDesc":true}')}}]);